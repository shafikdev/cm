<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Pattern Cutting Notes</title>
    <link rel="stylesheet" href="index.css" />
  </head>
  <body>
    <!-- Mobile Header -->
    <header class="mobile-header">
      <button class="hamburger-btn" id="hamburgerBtn">
        <span class="hamburger-line"></span>
        <span class="hamburger-line"></span>
        <span class="hamburger-line"></span>
      </button>
      <h1>Pattern Cutting Notes</h1>
    </header>

    <!-- Sidebar Navigation -->
    <aside class="sidebar" id="sidebar">
      <div class="sidebar-header">
        <h2>Table of Contents</h2>
      </div>
      <nav class="nav-menu">
        <ul id="patternList">
          <li>
            <a href="#" data-pattern="normal_selwar" class="nav-link active"
              >নরমাল সেলোয়ার</a
            >
          </li>
          <li>
            <a href="#" data-pattern="divider" class="nav-link"
              >ডিভাইডার সেলোয়ার</a
            >
          </li>
          <li>
            <a href="#" data-pattern="plazzu" class="nav-link"
              >প্লাজু সেলোয়ার</a
            >
          </li>
          <li>
            <a href="#" data-pattern="sharara" class="nav-link"
              >সারারা সেলোয়ার</a
            >
          </li>
          <li>
            <a href="#" data-pattern="garara" class="nav-link"
              >গারারা সেলোয়ার</a
            >
          </li>
          <li>
            <a href="#" data-pattern="choose" class="nav-link">চুজ সেলোয়ার</a>
          </li>
          <li>
            <a href="#" data-pattern="churidar" class="nav-link"
              >চুড়িদার সেলায়ার</a
            >
          </li>
          <li>
            <a href="#" data-pattern="pant" class="nav-link"
              >প‍্যান্ট কাট সেলায়ার</a
            >
          </li>
        </ul>
      </nav>
    </aside>

    <!-- Main Content Area -->
    <main class="main-content" id="mainContent">
      <div class="content-container">
        <div class="welcome-message">
          <h1>Welcome to Pattern Cutting Notes</h1>
          <p>
            Select a pattern from the menu to view detailed cutting instructions
            and measurements.
          </p>
        </div>
      </div>
    </main>

    <!-- Overlay for mobile menu -->
    <div class="overlay" id="overlay"></div>

    <script>
      class PatternCuttingApp {
        constructor() {
          this.hamburgerBtn = document.getElementById("hamburgerBtn");
          this.sidebar = document.getElementById("sidebar");
          this.overlay = document.getElementById("overlay");
          this.mainContent = document.getElementById("mainContent");
          this.navLinks = document.querySelectorAll(".nav-link");
          this.allPatterns = [
            "normal_selwar",
            "divider",
            "plazzu",
            "sharara",
            "garara",
            "choose",
            "churidar",
            "pant",
          ]; // Add new patterns here

          this.init();
        }

        init() {
          this.setupEventListeners();
          this.loadAllPatterns();
        }

        setupEventListeners() {
          // Hamburger menu toggle
          this.hamburgerBtn.addEventListener("click", () =>
            this.toggleMobileMenu()
          );
          this.overlay.addEventListener("click", () => this.closeMobileMenu());

          // Navigation links - now scroll to sections
          this.navLinks.forEach((link) => {
            link.addEventListener("click", (e) => this.handleNavClick(e));
          });

          // Close mobile menu when clicking on nav link
          this.navLinks.forEach((link) => {
            link.addEventListener("click", () => this.closeMobileMenu());
          });

          // Handle window resize
          window.addEventListener("resize", () => this.handleResize());

          // Update active nav on scroll
          window.addEventListener("scroll", () =>
            this.updateActiveNavOnScroll()
          );
        }

        toggleMobileMenu() {
          this.sidebar.classList.toggle("active");
          this.overlay.classList.toggle("active");
          this.hamburgerBtn.classList.toggle("active");
        }

        closeMobileMenu() {
          this.sidebar.classList.remove("active");
          this.overlay.classList.remove("active");
          this.hamburgerBtn.classList.remove("active");
        }

        handleResize() {
          if (window.innerWidth > 768) {
            this.closeMobileMenu();
          }
        }

        handleNavClick(e) {
          e.preventDefault();
          const patternName = e.target.getAttribute("data-pattern");

          if (patternName) {
            this.scrollToPattern(patternName);
            this.setActiveNav(e.target);
          }
        }

        scrollToPattern(patternName) {
          const patternSection = document.getElementById(
            `pattern-${patternName}`
          );
          if (patternSection) {
            const offsetTop = patternSection.offsetTop - 20; // 20px offset for better visibility
            window.scrollTo({
              top: offsetTop,
              behavior: "smooth",
            });
          }
        }

        async loadAllPatterns() {
          try {
            this.showLoading();

            let allContent = '<div class="all-patterns-container">';

            for (let i = 0; i < this.allPatterns.length; i++) {
              const patternName = this.allPatterns[i];
              try {
                const response = await fetch(`${patternName}.html`);
                if (response.ok) {
                  const content = await response.text();
                  allContent += `
                                    <section id="pattern-${patternName}" class="pattern-section-wrapper">
                                        ${content}
                                    </section>
                                    ${
                                      i < this.allPatterns.length - 1
                                        ? '<div class="pattern-divider"></div>'
                                        : ""
                                    }
                                `;
                } else {
                  allContent += this.createErrorSection(
                    patternName,
                    "File not found"
                  );
                }
              } catch (error) {
                allContent += this.createErrorSection(
                  patternName,
                  error.message
                );
              }
            }

            allContent += "</div>";
            this.mainContent.innerHTML = allContent;

            // Set first nav item as active
            if (this.navLinks.length > 0) {
              this.setActiveNav(this.navLinks[0]);
            }
          } catch (error) {
            this.showGlobalError(error.message);
          }
        }

        createErrorSection(patternName, errorMessage) {
          return `
                    <section id="pattern-${patternName}" class="pattern-section-wrapper">
                        <div class="pattern-content">
                            <div class="pattern-header">
                                <div class="pattern-type">Error</div>
                                <h1>${patternName
                                  .replace("_", " ")
                                  .toUpperCase()}</h1>
                            </div>
                            <div class="error-message">
                                <p>Could not load this pattern: ${errorMessage}</p>
                            </div>
                        </div>
                    </section>
                `;
        }

        updateActiveNavOnScroll() {
          const scrollPosition = window.scrollY + 100; // Offset for better UX

          for (let i = this.allPatterns.length - 1; i >= 0; i--) {
            const patternName = this.allPatterns[i];
            const section = document.getElementById(`pattern-${patternName}`);
            const navLink = document.querySelector(
              `[data-pattern="${patternName}"]`
            );

            if (section && section.offsetTop <= scrollPosition) {
              this.setActiveNav(navLink);
              break;
            }
          }
        }

        setActiveNav(activeLink) {
          this.navLinks.forEach((link) => link.classList.remove("active"));
          if (activeLink) {
            activeLink.classList.add("active");
          }
        }

        showLoading() {
          this.mainContent.innerHTML = `
                    <div class="content-container">
                        <div class="loading">
                            <div class="loading-spinner"></div>
                            <p>Loading all patterns...</p>
                        </div>
                    </div>
                `;
        }

        showGlobalError(errorMessage) {
          this.mainContent.innerHTML = `
                    <div class="content-container">
                        <div class="error-message">
                            <h2>Failed to Load Patterns</h2>
                            <p class="error-details">${errorMessage}</p>
                            <p>Please make sure all pattern HTML files exist in the same directory as index.html</p>
                        </div>
                    </div>
                `;
        }
      }

      // Initialize the app when DOM is loaded
      document.addEventListener("DOMContentLoaded", () => {
        new PatternCuttingApp();
      });
    </script>
  </body>
</html>
